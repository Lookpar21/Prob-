<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Baccarat Analysis Lab — Full (8 Decks) v3</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>Baccarat Analysis Lab <span class="muted">— Full Version (8 Decks) v3</span></h1>
    <p class="subtitle">บันทึกไพ่แยกฝั่ง → วิเคราะห์ไพ่ใบถัดไป → จำลองตาถัดไป (Monte Carlo) → คำนวณ EV → ตัวอย่าง “ไพ่ถัดไป” แบบเลือกจำนวนใบได้</p>
  </header>

  <main>
    <section class="card">
      <h2>1) ตั้งค่าขอนไพ่ & บันทึกไพ่ที่ออกแล้ว</h2>
      <p class="help">เลือกฝั่ง (Player/Banker/Unknown) แล้วกดหน้าไพ่ A–K เพื่อ “ลบออกจากขอน” หรือพิมพ์เพิ่มเอง ระบบจะอัปเดตจำนวนที่เหลือและการคำนวณทั้งหมดให้</p>
      <div class="controls">
        <div class="control">
          <label>เลือกฝั่งที่จะลบไพ่:</label>
          <div class="side-toggle">
            <button id="sideP" class="side-btn active p">Player</button>
            <button id="sideB" class="side-btn b">Banker</button>
            <button id="sideU" class="side-btn u">Unknown</button>
          </div>
          <div style="height:8px"></div>
          <label>กดลบตามหน้าไพ่:</label>
          <div class="ranks-grid" id="rankButtons"></div>
          <div class="actions-row">
            <button id="btnUndo" title="คืนค่าไพ่ใบล่าสุด">Undo</button>
            <button id="btnReset" class="danger">รีเซ็ตทั้งหมด</button>
            <span class="small" id="totalLeft">เหลือทั้งหมด: 416</span>
          </div>
          <div class="actions-row">
            <div class="kv" style="width:100%">
              <label>พิมพ์หน้าไพ่แล้วเพิ่ม:</label>
              <div style="display:flex;gap:8px;width:100%">
                <input id="typedRank" type="text" placeholder="เช่น A หรือ 10 หรือ J" />
                <button id="btnAddRank" class="ghost">เพิ่ม</button>
              </div>
            </div>
          </div>
        </div>

        <div class="control">
          <label>รายการที่ลบ (แยกฝั่ง):</label>
          <div class="kv">
            <div>Player (<span id="cntP">0</span>)</div>
            <div id="badgesP" class="badges"></div>
            <div>Banker (<span id="cntB">0</span>)</div>
            <div id="badgesB" class="badges"></div>
            <div>Unknown (<span id="cntU">0</span>)</div>
            <div id="badgesU" class="badges"></div>
          </div>
        </div>

        <div class="control">
          <label>จำนวนที่เหลือต่อหน้าไพ่:</label>
          <div id="countsTable"></div>
        </div>
      </div>
      <p class="note">8 เด็ค → ไพ่แต่ละหน้า (A,2,...,K) เริ่มต้นหน้าไพ่ละ 32 ใบ (เพราะ 4 ใบ × 8 เด็ค)</p>
    </section>

    <section class="card">
      <h2>2) ความน่าจะเป็น “ไพ่ใบถัดไป”</h2>
      <p class="help">คำนวณจากไพ่ที่เหลืออยู่จริง ๆ ณ ตอนนี้ (ทั้งตามหน้าไพ่ และตามแต้ม Baccarat 0–9)</p>
      <div class="actions-row">
        <button id="btnNextCard" class="primary">คำนวณโอกาสไพ่ใบถัดไป</button>
      </div>
      <div id="nextProb" class="actions-row" style="margin-top:8px;display:block"></div>
    </section>

    <section class="card">
      <h2>3) จำนวน “การจัดเรียงที่เป็นไปได้” (Combinatorial)</h2>
      <p class="help">จำนวนวิธีที่เหลือซึ่งสอดคล้องกับไพ่ที่ออกแล้ว = <b>N<sub>rem</sub>!</b> / ∏<sub>rank</sub> (count<sub>rank</sub>!) — แสดงเป็นค่า log10 เพื่ออ่านง่าย และเทียบกับ 416!</p>
      <div class="actions-row">
        <button id="btnCountPerms" class="primary">คำนวณจำนวนวิธีที่เหลือ</button>
      </div>
      <div id="permsOut" class="actions-row" style="margin-top:8px;display:block"></div>
    </section>

    <section class="card">
      <h2>4) จำลอง “ตาถัดไป” แบบ Baccarat เต็มกฎ (Monte Carlo)</h2>
      <p class="help">ประมาณ Natural %, Player/Banker จั่ว %, และผลลัพธ์ Player/Banker/Tie</p>
      <div class="controls">
        <div class="control">
          <label for="simN">จำนวนรอบจำลอง</label>
          <input id="simN" type="number" min="1000" max="2000000" step="1000" value="200000" />
        </div>
        <div class="control">
          <label for="tiePayout">ค่าน้ำ Tie (จ่าย)</label>
          <select id="tiePayout">
            <option value="8" selected>8 : 1</option>
            <option value="9">9 : 1</option>
          </select>
        </div>
        <div class="actions-row">
          <button id="btnSim" class="primary">เริ่มจำลอง</button>
          <span id="simStatus" class="status"></span>
        </div>
      </div>
      <div id="simResults" class="tables-wrap"></div>
    </section>

    <section class="card">
      <h2>5) คำแนะนำอัตโนมัติ (EV & Recommendation)</h2>
      <p class="help">ระบบจะคำนวณ EV ของ Banker / Player / Tie จากผลจำลองล่าสุด แล้วสรุปว่าควร “ลงอะไร” หรือ “รอ”</p>
      <div id="recBox" class="recommend neutral">
        <p class="rec-title">ยังไม่มีผลจำลอง</p>
        <p class="rec-sub">กด “เริ่มจำลอง” ก่อน แล้วระบบจะแนะนำให้อัตโนมัติ</p>
      </div>
      <div id="evTable" class="tables-wrap" style="margin-top:10px;"></div>
    </section>

    <section class="card">
      <h2>6) ตัวอย่างสุ่ม “ไพ่ถัดไป” (เลือกจำนวนใบ)</h2>
      <p class="help">สุ่มเรียงไพ่จากจำนวนที่เหลือจริงในขอน ณ ตอนนี้ แล้วแสดง N ใบแรก (ใช้เพื่อดูแนวโน้ม — เปลี่ยนทุกครั้งที่กด)</p>
      <div class="actions-row">
        <label for="previewCount">จำนวนใบที่จะดู</label>
        <select id="previewCount">
          <option value="10">10 ใบ</option>
          <option value="20">20 ใบ</option>
          <option value="30" selected>30 ใบ</option>
          <option value="50">50 ใบ</option>
        </select>
        <button id="btnShowN" class="primary">สุ่มและแสดงไพ่ถัดไป</button>
        <div style="display:flex;gap:8px;align-items:center">
          <label for="realNext">ไพ่จริงใบถัดไปคือ</label>
          <input id="realNext" type="text" placeholder="เช่น A, 10, J, Q, K" style="max-width:160px">
          <button id="btnConfirmNext" class="ghost">ยืนยันไพ่จริง & ปรับ</button>
        </div>
        <button id="btnCopyN" class="ghost">คัดลอกเป็นข้อความ</button>
      </div>
      <div id="observedList" class="note" style="margin-top:6px;"></div>
      <div id="nextN" class="tables-wrap" style="margin-top:8px;"></div>
    </section>
  </main>

  <footer>
    <p>หมายเหตุ: เสมอ (Tie) ส่วนใหญ่จ่าย 8:1 ถ้าโต๊ะคุณจ่าย 9:1 ให้เลือกในเมนูเพื่อคำนวณ EV ให้ตรง</p>
  </footer>

  <script src="script.js"></script>
</body>
</html>
